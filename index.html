<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">



















                   <section data-markdown><script type="text/template">

# Code Reuse durch Libraries 
### Open Source einfach selbst gemacht

von Michael Zinn

</script></section><section data-markdown><script type="text/template">

## Wer?
- Michael Zinn
- Java, Kotlin, JavaScript, TypeScript, CoffeeScript, PureScript, Ruby, Clojure, Haskell
- Funktionale Programmierung, Automatisierung, Craftmanship
- Twitter/Github: RedNifre

</script></section><section data-markdown><script type="text/template">

## Tech Talks

| Wann | Was | Wozu |
|-----:|------|----------|
|  2016 | Kotlin | Besseres Java |
|  2016 | Funktionale Programmierung | Besser Programmieren |
|  2017 | Open Source Libraries | Besseres Code Reuse |

</script></section><section data-markdown><script type="text/template">

## Agenda

1. Warum Libraries schreiben?
2. Wie veröffentlichen?
3. Beispiele
 
</script></section><section data-markdown><script type="text/template">

# Warum Libraries schreiben?

</script></section><section data-markdown><script type="text/template">

## Vorteile von Code Reuse:

- DRY: Don't Repeat Yourself
- Weniger Code → Weniger Bugs
- Bugs müssen nur an einer Stelle gefixt werden

</script></section><section data-markdown><script type="text/template">

# Wie?

</script></section><section data-markdown><script type="text/template">

## Wie?

1. Code schreiben
2. Lizenz
3. Publish
4. ReadMe

</script></section><section data-markdown><script type="text/template">

## Lizenz

</script></section><section data-markdown><script type="text/template">

### Lizenz
- MIT
- Apache v2
- LGPL
- GPL

</script></section><section data-markdown><script type="text/template">

### MIT License

* Tu was du willst.

* Verklag mich nicht.

```none
Copyright (c) <year> <copyright holders>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

</script></section><section data-markdown><script type="text/template">

### Apache v2

- Ähnliche Freiheiten wie MIT Lizenz
- Firmen haben keine Angst davor

</script></section><section data-markdown><script type="text/template">

### LGPL
- Du darfst es benutzen ohne dass du deinen eigenen Code opensourcen musst.
- Du musst vom Code abgeleitete Werke unter der LGPL veröffentlichen.
- Von in der Library enthaltenen Klassen zu erben oder Interfaces zu implementieren erzeugt KEIN abgeleitetes Werk.

</script></section><section data-markdown><script type="text/template">

### GPL
- Die Library darf nur in Projekten verwendet werden die ebenfalls unter der GPL stehen (viral)
- Sinn: Das Open Source Ökosystem stärken
- In Firmen üblicherweise verboten

</script></section><section data-markdown><script type="text/template">

## Publish

</script></section><section data-markdown><script type="text/template">

### Go

</script></section><section data-markdown><script type="text/template">

### Go
1. Auf github veröffentlichen

</script></section><section data-markdown><script type="text/template">

### Go
1.
```sh
$ go get github.com/someuser/somelibrary
```

2.
```go
import "github.com/someuser/somelibrary"
```

</script></section><section data-markdown><script type="text/template">

### Javascript

</script></section><section data-markdown><script type="text/template">

### Javascript
0. ```$ npm init```
1. npmjs.com Account erstellen
2. ```$ npm publish```

</script></section><section data-markdown><script type="text/template">

### Javascript
```sh
$ npm install --save somelibrary
```

</script></section><section data-markdown><script type="text/template">

### Java

</script></section><section data-markdown><script type="text/template">

### Java
1. Maven Central Account erstellen
2. Sonatype Account erstellen
3. Beide Accounts verknüpfen
4. Einen PGP-Key erzeugen
5. Den Key auf einem öffentlichen Server hinterlegen
6. Javadoc schreiben
7. Sonatype-Jira Account erstellen
8. GroupId per Jira-Ticket beantragen
9. Artefakte signieren
10. Artefakte bei einem erlaubten Provider hosten
11. Library einreichen
12. Ein paar Tage warten
13. Formfehler beheben
14. Goto 11
15. Eine Ziege opfern

</script></section><section>

<img src="maven.jpg">

</section><section data-markdown><script type="text/template">

o_O

</script></section><section data-markdown><script type="text/template">

### Java
1. Maven Central Account erstellen
2. Sonatype Account erstellen
3. Beide Accounts verknüpfen
4. Einen PGP-Key erzeugen
5. Den Key auf einem öffentlichen Server hinterlegen
6. Javadoc schreiben
7. Sonatype-Jira Account erstellen
8. GroupId per Jira-Ticket beantragen
9. Artefakte signieren
10. Artefakte bei einem erlaubten Provider hosten
11. Library einreichen
12. Ein paar Tage warten
13. Formfehler beheben
14. Goto 11
15. Eine Ziege opfern

</script></section><section data-markdown><script type="text/template">

Was ist unser Ziel?

</script></section><section data-markdown><script type="text/template">

## Ziel:

* Man kann die Library einfach einbinden
* Maven-Support
* Gradle-Support

</script></section><section data-markdown><script type="text/template">

## Jar?
- Okay in Gradle 
- Fummelig in Maven 

</script></section><section data-markdown><script type="text/template">

## Library in Maven Central?

```xml
<dependency>
	<groupId>biz.cosee.null4j</groupId>
	<artifactId>null4j</artifactId>
	<version>0.9.0</version>
</dependency>
```

</script></section><section data-markdown><script type="text/template">

## Library in einem anderen Repo?

```xml
<dependencies>
	<dependency>
		<groupId>biz.cosee.null4j</groupId>
		<artifactId>null4j</artifactId>
		<version>0.9.0</version>
	</dependency>
</dependencies>

<repositories>
	<repository>
		<id>jcenter</id>
		<url>http://jcenter.bintray.com </url>
	</repository>
</repositories>
```

</script></section><section data-markdown><script type="text/template">

## JCenter

</script></section><section data-markdown><script type="text/template">

## JCenter
* Quasi wie Maven Central
* Kein Sonatype
* Kein Javadoc
* Keine Jira-Tickets
* Grauenhafter, aber schaffbarer Approval-Prozess

</script></section><section data-markdown><script type="text/template">

JFrog:

> Hi,
> 
> JCenter hosts open source applications using the Maven naming convention which has 3 components. For example, a valid allocated path might be: org/apache/maven
> 
> The path of the file you have requested to include is missing one of the components. 
> 
> Please update your JCenter inclusion path and we will be glad to approve the request.
> 
> With Regards,
> JFrog Support

</script></section><section data-markdown><script type="text/template">

JFrog:

> Hi,
> 
> JCenter hosts java applications that follow maven convention. In addition to the jar and .pom files, your version should also include a sources jar, and optionally a javadoc jar.
> Your files should be under a maven path layout. (See https://bintray.com/docs...)
> 
> Once those files are added, we'll be glad to include your package in JCenter
> 
> Regards,
> JFrog Support

</script></section><section data-markdown><script type="text/template">

JFrog:
> We are not sure what is meant by a "step-by-step tutorial".

</script></section><section data-markdown><script type="text/template">

JFrog:

> … Maven naming convention which has 3 components…
> Please update your JCenter inclusion path…

Michael:

> … doesn't "biz.cosee.null4j" and biz/cosee/null4j have three parts already? 

JFrog:

> Your request to include your package… has been approved. 

</script></section><section data-markdown><script type="text/template">

Wo hosten?
Wie PGP-signieren?

</script></section><section data-markdown><script type="text/template">

## Bintray

</script></section><section data-markdown><script type="text/template">

## Bintray
- Artefact Hoster (samt Versionierung)
- Kann PGP-Keys verwalten
- Kann in JCenter publishen
- Für Open-Source-Projekte kostenlos
- Erträgliche Website


</script></section><section data-markdown><script type="text/template">

Gradle?

</script></section><section data-markdown><script type="text/template">

## Gradle

- Wie Maven
- Einfacher
- Langsamer, mehr Bugs
- Kann relativ einfach Maven POMs generieren

</script></section><section data-markdown><script type="text/template">

Wie bauen?

</script></section><section data-markdown><script type="text/template">

## Travis C I

</script></section><section data-markdown><script type="text/template">

## Travis C I
- Baut Artefakte
- Kann die Artefakte nach Bintray schicken
- Für Open-Source-Projekte kostenlos
- Tatsächlich gute Website

</script></section><section data-markdown><script type="text/template">

Wo hosten?

</script></section><section data-markdown><script type="text/template">

## Github

</script></section><section data-markdown><script type="text/template">

## Github
- TravisCI baut jeden neuen Commit auf dem Master-Branch

</script></section><section data-markdown><script type="text/template">

### Klassisch
1. Maven Central Account erstellen
2. Sonatype Account erstellen
3. Beide Accounts verknüpfen
4. Einen PGP-Key erzeugen
5. Den Key auf einem öffentlichen Server hinterlegen
5. Eine Ziege opfern
6. Javadoc schreiben
7. Sonatype-Jira Account erstellen
8. GroupId per Jira-Ticket beantragen
9. Artefakte signieren
10. Artefakte bei einem erlaubten Provider hosten
11. Library einreichen
12. Ein paar Tage warten
13. Formfehler beheben
14. Goto 11
15. Eine Ziege opfern

</script></section><section data-markdown><script type="text/template">

### Einfacher

Github Master

↓

TravisCI

↓

Bintray

↓

JCenter

+

Jede Menge Boilerplate-Dateien

</script></section><section data-markdown><script type="text/template">

...Boilerplate-Dateien?

</script></section><section data-markdown><script type="text/template">

### Boilerplate-Dateien

- build.gradle
- .travis.yaml
- descriptor.json

</script></section><section data-markdown><script type="text/template">

### build.gradle

```gradle
apply plugin: 'maven-publish'

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
            pom.withXml {
                asNode().dependencies.'*'.findAll() {
                    it.scope.text() == 'runtime' && project.configurations.compile.allDependencies.find { dep ->
                        dep.name == it.artifactId.text()
                    }
                }.each() {
                    it.scope*.value = 'compile'
                }
            }
        }
    }
}

model {
    tasks.generatePomFileForMavenPublication {
        destination = file("$buildDir/libs/ravr-0.0.10.pom")
    }
}
```

</script></section><section data-markdown><script type="text/template">

### .travis.yaml

```yaml
language: java
jdk:
  - oraclejdk8
before_install:
  - chmod +x gradlew

before_deploy:
  - ./gradlew generatePomFileForMavenPublication
  - ./gradlew sourcesJar

deploy:
  provider: bintray
  file: "descriptor.json"
  user: $BINTRAY_API_USER
  key: $BINTRAY_API_KEY
  dry-run: false
```

</script></section><section data-markdown><script type="text/template">

### descriptor.json

```json
{
	"package": {
		"name": "null4j",
			"repo": "null4j",
			"subject": "cosee",
			"desc": "Simplified null handling",
			"website_url": "https://github.com/cosee/null4j",
			"issue_tracker_url": "https://github.com/cosee/null4j/issues",
			"vcs_url": "https://github.com/cosee/null4j",
			"licenses": ["Apache-2.0"],
			"labels": ["java"],
			"public_download_numbers": false,
			"public_stats": false
	},
	 
	"version": {
	  "name": "0.9.2",
	  "released": "2017-06-21",
	  "gpgSign": false
	},
	 
	"files": [
		{"includePattern": "build/libs/(.*)", "uploadPattern": "biz/cosee/null4j/null4j/0.9.2/$1"}
	],
	"publish": true
}
```

</script></section><section data-markdown><script type="text/template">

Geht das auch einfacher?

</script></section><section data-markdown><script type="text/template">

...vielleicht?

</script></section><section data-markdown><script type="text/template">

### Boilerplate per Script generieren?

```sh
$ cd mylibrary
$ sacrifice_goat.sh
Generating descriptor.json...
Generating .travis.yaml...
Augmenting build.gradle...
Done!
$ 
```

</script></section><section data-markdown><script type="text/template">

# Beispiele

</script></section><section data-markdown><script type="text/template">

## Beispiele
- Ravr
- null4j
- ExStream

</script></section><section data-markdown><script type="text/template">

## Ravr

</script></section><section data-markdown><script type="text/template">

### FP in Javascript
- Ramda (Funktionen)
- Folktale (Daten)

</script></section><section data-markdown><script type="text/template">

### FP in Java
- vavr (Daten + Objekt-funktionale Methoden)

</script></section><section data-markdown><script type="text/template">

### FP in Java
- vavr (Daten)
- Ravr (Funktionen)

</script></section><section data-markdown><script type="text/template">

## Ravr
- Portierung einer .js Library
- Ermöglicht gleichen Code im Frontend und Backend
- Gutes Einstiegsprojekt

</script></section><section data-markdown><script type="text/template">

## null4j

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(null);
	}

}
```

1. String hat eine substring Methode
2. null ist ein String (null ist von jedem Typ)
3. null hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(null);
	}

}
```

1. ~~String hat eine substring Methode~~
2. null ist ein String (null ist von jedem Typ)
3. null hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java
class Example {
	String chop(String string) {
		if(string == null) {
			return null; // deal with it
		} else {
			return string.substring(0, string.length - 1);
		}
	}
	void main() {
		String fail = chop(null);
	}
}
```

1. ~~String hat eine substring Methode~~
2. null ist ein String (null ist von jedem Typ)
3. null hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(null);
	}

}
```

1. String hat eine substring Methode
2. null ist ein String (null ist von jedem Typ)
3. null hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(null);
	}

}
```

1. String hat eine substring Methode
2. ~~null ist ein String (null ist von jedem Typ)~~
3. null hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(Optional.empty());❌
	}

}
```

1. String hat eine substring Methode
2. ~~Optional&lt;String> ist ein String~~
3. Optional&lt;String> hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java

class Example {

	@NotNull String chop(@NotNull String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		@NotNull String fail = chop(null);❌
	}

}
```

1. @NotNull String hat eine substring Methode
2. null ist ein @Nullable String, aber KEIN @NotNull String
3. @Nullable String hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### Das Null-Problem

```java
@NotNullByDefault
class Example {

	String chop(String string) {
		return string.substring(0, string.length - 1);
	}

	void main() {
		String fail = chop(null);❌
	}

}
```

1. String hat eine substring Methode
2. null ist ein @Nullable String, aber KEIN String
3. @Nullable String hat keine substring Methode

</script></section><section data-markdown><script type="text/template">

### null4j

- Löst ein konkretes Problem
- Wenige, einfache, aber mächtige Funktionen (Nur orDefault und let, die aber kombinierbar sind)
- Ausführliche README, da es auch von anderen genutzt werden soll

```java
return orDefault(let(person,
	Person::getAddress,
	Address::getStreet,
	Street::getName), "?NO STREET NAME");
```

</script></section><section data-markdown><script type="text/template">

## ExStream

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(User::getAccounts)
	.sortBy(Account::getId);
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(User::getAccounts.stream())
	.sortBy(Account::getId);
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(User::getAccounts.andThen(List::stream))
	.sortBy(Account::getId);
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sortBy(Account::getId);
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(Comparators.comparing(Account::getId));
᠎

```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(Comparators.comparing(Account::getId))
	.toList();
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(Comparators.comparing(Account::getId))
	.collect(Collectors.toList());
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(comparing(Account::getId))
	.collect(toList());
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(comparing(Account::getId))
	.collect(toList());
```

```haskell
sortWith accountId (accounts =<< users)
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(comparing(Account::getId))
	.collect(toList());
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(user -> user.getAccounts().stream()),
	sorted(comparing(Account::getId)),
	collect(toList()));
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(user -> user.getAccounts()),
	sorted(comparing(Account::getId)),
	collect(toList()));
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	sorted(comparing(Account::getId)),
	collect(toList()));
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	sortBy(Account::getId),
	collect(toList()));
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	sortBy(Account::getId),
	toList());
```

</script></section><section data-markdown><script type="text/template">

### Java Stream API -> ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	sortBy(Account::getId));
᠎
```

</script></section><section data-markdown><script type="text/template">

### ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	sortBy(Account::getId));
᠎
```

</script></section><section data-markdown><script type="text/template">

### ExStream

```java
return stream(users,
	flatMap(User::getAccounts),
	shuffle());
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java

```java
return optionalUser
	.flatMap(User::getAccounts);
᠎
```

</script></section><section data-markdown><script type="text/template">

### Java

```java
return optionalUser
	.map(User::getAccounts)
	.orElse(Collections.emptyList());
```

</script></section><section data-markdown><script type="text/template">

### ExStream

```java
return stream(optionalUser,
	flatMap(User::getAccounts));
᠎
```

</script></section><section data-markdown><script type="text/template">

### ExStream

```java
return stream(completableFutureUser,
	flatMap(getUserDataFromSomewhereAsCompletableFuture),
	toCompletableFuture());
```

</script></section><section data-markdown><script type="text/template">

### ExStream
- Bietet nichts fundamental neues
- Vereinfacht bereits existierende Funktionalität

```java
// Viel Boilerplate Stuff
return users.stream()
	.flatMap(user -> user.getAccounts().stream())
	.sorted(Comparators.comparing(Account::getId))
	.collect(Collectors.toList());

// Weniger BS
return stream(users,
	flatMap(User::getAccounts),
	sortBy(Account::getId));
```

</script></section><section data-markdown><script type="text/template">

# Zusammenfassung

</script></section><section data-markdown><script type="text/template">

## Zusammenfassung

- Passende Lizenz aussuchen!
- Github → TravisCI → Bintray → JCenter
- Durchbeißen! (Oder andere Sprache benutzen)
- Lieblings-Libraries aus anderen Sprachen portieren
- Probleme lösen
- Programmieren angenehmer gestalten

</script></section><section data-markdown><script type="text/template">

# EOF

</script></section><section data-markdown><script type="text/template">

### Nächster TechTalk:

## Gibt's da nicht auch was von AWS?
#### Andreas Mohrhard

</script></section><section data-markdown><script type="text/template">

## P.S.:

facebook.com/coseegmbh

Twitter: @coseeaner, @RedNifre

</script></section>












			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				transition: 'none',
				transitionSpeed: 'fast',
				backgroundTransition: 'none',
				controls: false,
				progress: false,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
